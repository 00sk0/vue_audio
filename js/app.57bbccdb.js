(function(t){function e(e){for(var n,o,c=e[0],s=e[1],l=e[2],u=0,f=[];u<c.length;u++)o=c[u],r[o]&&f.push(r[o][0]),r[o]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n]);h&&h(e);while(f.length)f.shift()();return a.push.apply(a,l||[]),i()}function i(){for(var t,e=0;e<a.length;e++){for(var i=a[e],n=!0,c=1;c<i.length;c++){var s=i[c];0!==r[s]&&(n=!1)}n&&(a.splice(e--,1),t=o(o.s=i[0]))}return t}var n={},r={app:0},a=[];function o(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=n,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(i,n,function(e){return t[e]}.bind(null,n));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/vue_audio/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var h=s;a.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"034f":function(t,e,i){"use strict";var n=i("64a9"),r=i.n(n);r.a},"0574":function(t,e,i){},"074f":function(t,e,i){"use strict";var n=i("0574"),r=i.n(n);r.a},"56d7":function(t,e,i){"use strict";i.r(e);i("cadf"),i("551c"),i("f751"),i("097d");var n=i("2b0e"),r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("visualizer")],1)},a=[],o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"main"}},[i("canvas",{attrs:{id:"canvas",width:"640px",height:"360px"}}),i("div",{attrs:{id:"ctrls"}},[i("p",[i("audio",{attrs:{controls:"",id:"audiosource"}}),i("input",{attrs:{type:"file",id:"audiofile",accept:"audio/*"},on:{change:t.loadAudio}})]),i("p",[t._l(t.components,function(e){return i("span",{key:e.name},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.cont.on,expression:"cp.cont.on"}],attrs:{type:"checkbox",id:e.name},domProps:{checked:Array.isArray(e.cont.on)?t._i(e.cont.on,null)>-1:e.cont.on},on:{change:function(i){var n=e.cont.on,r=i.target,a=!!r.checked;if(Array.isArray(n)){var o=null,c=t._i(n,o);r.checked?c<0&&t.$set(e.cont,"on",n.concat([o])):c>-1&&t.$set(e.cont,"on",n.slice(0,c).concat(n.slice(c+1)))}else t.$set(e.cont,"on",a)}}}),i("label",{attrs:{for:e.name}},[t._v(t._s(e.name))])])}),t._v("\n      |\n      Accum_interval: "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.components[0].cont.interval,expression:"components[0].cont.interval"}],attrs:{type:"text"},domProps:{value:t.components[0].cont.interval},on:{input:function(e){e.target.composing||t.$set(t.components[0].cont,"interval",e.target.value)}}}),t._v("\n      Accum_amp_log: "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.components[0].cont.f_amp_log,expression:"components[0].cont.f_amp_log"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.components[0].cont.f_amp_log)?t._i(t.components[0].cont.f_amp_log,null)>-1:t.components[0].cont.f_amp_log},on:{change:function(e){var i=t.components[0].cont.f_amp_log,n=e.target,r=!!n.checked;if(Array.isArray(i)){var a=null,o=t._i(i,a);n.checked?o<0&&t.$set(t.components[0].cont,"f_amp_log",i.concat([a])):o>-1&&t.$set(t.components[0].cont,"f_amp_log",i.slice(0,o).concat(i.slice(o+1)))}else t.$set(t.components[0].cont,"f_amp_log",r)}}})],2),i("p",[t._v("filter: "+t._s(t.filtering?"on":"off")+".\n      "),i("button",{on:{click:t.toggle}},[t._v("toggle")])]),i("p",[t._v("\n      filter_lfo_center="),i("input",{directives:[{name:"model",rawName:"v-model",value:t.filter.center,expression:"filter.center"}],attrs:{type:"text"},domProps:{value:t.filter.center},on:{input:function(e){e.target.composing||t.$set(t.filter,"center",e.target.value)}}}),t._v("[Hz],\n      filter_lfo_amp="),i("input",{directives:[{name:"model",rawName:"v-model",value:t.filter.amp,expression:"filter.amp"}],attrs:{type:"text"},domProps:{value:t.filter.amp},on:{input:function(e){e.target.composing||t.$set(t.filter,"amp",e.target.value)}}}),t._v("[Hz],\n      filter_lfo_freq="),i("input",{directives:[{name:"model",rawName:"v-model",value:t.filter.lfreq,expression:"filter.lfreq"}],attrs:{type:"text"},domProps:{value:t.filter.lfreq},on:{input:function(e){e.target.composing||t.$set(t.filter,"lfreq",e.target.value)}}}),t._v("[count].\n    ")])])])},c=[],s=(i("4917"),i("7f7f"),i("20d6"),i("ac6a"),i("774e")),l=i.n(s),h=(i("34ef"),i("768b")),u=i("d225"),f=i("b0b4"),p=function(){function t(){Object(u["a"])(this,t),this.fft_size=1024}return Object(f["a"])(t,[{key:"init",value:function(t){var e=t.width,i=t.height,n=t.ctx,r=t.audio,a=t.components;this.width=e,this.height=i,this.cctx=n,this.init_nodes(r);var o=this.anlz.frequencyBinCount;this.length=o;var c=this.calc_log(),s=Object(h["a"])(c,2),l=s[0],u=s[1];this.length_log=l,this.buf_time=new Uint8Array(o),this.buf_freq=new Uint8Array(o),this.buf_freq_log=new Uint8Array(l),this.components=this.init_components(u,a),this.filtering=!1,this.loop()}},{key:"init_nodes",value:function(t){var e=new AudioContext,i=e.createGain();i.connect(e.destination);var n=e.createBiquadFilter();n.type="highshelf",n.connect(i);var r=e.createAnalyser();r.fftSize=this.fft_size,i.connect(r);var a=e.createMediaElementSource(t);a.connect(n),this.actx=e,this.anlz=r,this.out=i,this.filter=n,this.filter_count=0,this.filter_center=0,this.filter_amp=0,this.filter_lfreq=0,this.audio=a}},{key:"init_components",value:function(t,e){var i=this,n=[this.length,this.length_log],r=n[0],a=n[1],o=l()({length:r},function(t,e){return e*i.width/r});o.push(this.width);var c={width:this.width,height:this.height,length:r,pos:o,ctx:this.cctx},s={width:this.width,height:this.height,length:a,pos:t,ctx:this.cctx},h={arg_linear:c,arg_log:s};return e.map(function(t){return t.init(h),t})}},{key:"update_filter",value:function(t,e,i){this.filter_center=t,this.filter_amp=e,this.filter_lfreq=i}},{key:"toggle_filter",value:function(t,e,i){var n=this.actx;return this.filtering?(this.filtering=!1,this.filter.frequency.cancelScheduledValues(n.currentTime),this.filter.gain.cancelScheduledValues(n.currentTime),this.filter.Q.cancelScheduledValues(n.currentTime),this.filter.type="highshelf",this.filter.frequency.setValueAtTime(0,n.currentTime),this.filter.gain.setValueAtTime(0,n.currentTime)):(this.filtering=!0,this.filter.Q.setValueAtTime(4,n.currentTime),this.filter_center=t,this.filter_amp=e,this.filter_lfreq=i,this.filter.type="lowpass"),this.filtering}},{key:"loop",value:function(){if(this.filtering&&"lowpass"===this.filter.type&&this.filter_lfreq>=1){var t=this.actx;this.filter.frequency.cancelScheduledValues(t.currentTime),this.filter.gain.cancelScheduledValues(t.currentTime),this.filter.Q.cancelScheduledValues(t.currentTime);var e=1*this.filter_center+1*this.filter_amp*Math.sin(this.filter_count/this.filter_lfreq*2*Math.PI);this.filter.frequency.setValueAtTime(e,this.actx.currentTime)}this.filter_count++>=this.filter_lfreq&&(this.filter_count=0),this.anlz.getByteTimeDomainData(this.buf_time),this.anlz.getByteFrequencyData(this.buf_freq),this.update_buf_freq_log();var i={buf_time:this.buf_time,buf_freq:this.buf_freq,buf_freq_log:this.buf_freq_log};this.cctx.clearRect(0,0,this.width,this.height),this.components.forEach(function(t){return t.draw(i)}),requestAnimationFrame(this.loop.bind(this))}},{key:"x_calc",value:function(t){return 0===t?0:Math.log(t)*this.width/Math.log(this.length)}},{key:"update_buf_freq_log",value:function(){for(var t=0,e=0,i=0,n=0,r=0;r<this.buf_freq.length;r++){var a=this.buf_freq[r],o=this.x_calc(r),c=this.x_calc(r+1)-o;o+c-t<4?(i++,e+=a):(this.buf_freq_log[n]=(e+a)/(i+1),n++,t=o+c,i=0,e=0)}}},{key:"calc_log",value:function(){for(var t=0,e=[],i=0,n=0;n<this.length;n++){var r=this.x_calc(n),a=this.x_calc(n+1)-r;r+a-t<4?0:(i++,e.push(t),t=r+a,0)}return e.push(this.width),[i,e]}}]),t}(),d=i("308d"),m=i("6bb5"),g=i("4e2b"),v=function(){function t(){Object(u["a"])(this,t),this.inited=!1,this.on=!0}return Object(f["a"])(t,[{key:"init_log",value:function(t){var e=t.arg_log,i=e.width,n=e.height,r=e.length,a=e.pos,o=e.ctx;this.inited=!0,this.width=i,this.height=n,this.length=r,this.pos=a,this.ctx=o}},{key:"init_linear",value:function(t){var e=t.arg_linear,i=e.width,n=e.height,r=e.length,a=e.pos,o=e.ctx;this.inited=!0,this.width=i,this.height=n,this.length=r,this.pos=a,this.ctx=o}},{key:"init",value:function(t){this.init_log(t)}},{key:"draw",value:function(t){this.ctx.save(),this.inited&&this.on&&this.draw_internal(t),this.ctx.restore()}},{key:"draw_internal",value:function(){throw new Error("to be implemented")}},{key:"toggle",value:function(){this.on=!this.on}}]),t}(),_=function(t){function e(){return Object(u["a"])(this,e),Object(d["a"])(this,Object(m["a"])(e).apply(this,arguments))}return Object(g["a"])(e,t),Object(f["a"])(e,[{key:"draw_internal",value:function(t){var e=t.buf_freq_log;this.ctx.fillStyle="hsla(0,60%,60%,0.8)";for(var i=0;i<this.length;i++){var n=[this.pos[i],this.pos[i+1]],r=n[0],a=n[1],o=e[i]*this.height/255;this.ctx.fillRect(r,this.height-o,a-r,o)}}}]),e}(v),y=(i("6c7b"),function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return[i+t*Math.cos(2*e*Math.PI-Math.PI/2),n+t*Math.sin(2*e*Math.PI-Math.PI/2)]}),b=function(t){function e(){return Object(u["a"])(this,e),Object(d["a"])(this,Object(m["a"])(e).apply(this,arguments))}return Object(g["a"])(e,t),Object(f["a"])(e,[{key:"draw_internal",value:function(t){var e=t.buf_freq_log,i=this.width/2,n=this.height/2,r=3*this.height/16,a=1*this.height/4;this.ctx.fillStyle="hsla(120,60%,60%,0.8)";for(var o=0;o<this.length;o++){var c=e[o]/255,s=this.pos[o]/this.width,l=this.pos[o+1]/this.width,u=0,f=y(r,s-u,i,n),p=Object(h["a"])(f,2),d=p[0],m=p[1],g=y(r,l-u,i,n),v=Object(h["a"])(g,2),_=v[0],b=v[1],x=y(c*a,(s+l)/2-u),w=Object(h["a"])(x,2),O=w[0],j=w[1];this.ctx.beginPath(),this.ctx.moveTo(_,b),this.ctx.lineTo(d,m),this.ctx.lineTo(d+O,m+j),this.ctx.lineTo(_+O,b+j),this.ctx.closePath(),this.ctx.fill()}}}]),e}(v),x=(i("7514"),i("75fc")),w=i("2a88"),O=function(t){function e(){var t;return Object(u["a"])(this,e),t=Object(d["a"])(this,Object(m["a"])(e).apply(this,arguments)),t.idx=0,t.count=0,t.cells=64,t.accum=[],t.span=10,t.f_amp_log=!1,t}return Object(g["a"])(e,t),Object(f["a"])(e,[{key:"init",value:function(t){Object(w["a"])(Object(m["a"])(e.prototype),"init",this).call(this,t),this.tmp=Object(x["a"])(Array(this.length)).map(function(t){return 0})}},{key:"draw_internal",value:function(t){var e=this,i=t.buf_freq_log;if(this.count++>=this.span){for(var n=0;n<this.length;n++)this.tmp[n]+=i[n],this.span>=1&&(this.tmp[n]/=this.count);if(this.tmp.findIndex(function(t){return t<0||t>255})>=0)throw new Error("invalid value: [".concat(this.tmp,"]"));this.accum[this.idx]=this.tmp.map(function(t){return t}),this.idx++,this.idx===this.cells&&(this.idx=0),this.tmp=Object(x["a"])(Array(this.length)).map(function(t){return 0}),this.count=0}else for(var r=0;r<this.length;r++)this.tmp[r]+=i[r];for(var a=function(t){var i=(t+e.idx)%e.cells,n=t*e.height/e.cells;if(e.accum[i]&&"undefined"!==typeof e.accum[i].find(function(t){return t>0}))for(var r=function(t){var r=[e.pos[t],e.pos[t+1]],a=r[0],o=r[1],c=function(){var n=e.accum[i][t];if(e.f_amp_log){var r=5;return Math.log(n/r+1)/Math.log(255/r+1)}return n/255}();e.ctx.fillStyle="hsla(".concat(220+60*c,",60%,60%,").concat(c,")"),e.ctx.fillRect(a,n,o-a,e.height/e.cells)},a=0;a<e.length;a++)r(a)},o=0;o<this.cells;o++)a(o)}},{key:"interval",get:function(){return this.span},set:function(t){this.span=t,this.tmp=Object(x["a"])(Array(this.length)).map(function(t){return 0}),this.count=0}}]),e}(v),j={name:"Visualizer",data:function(){var t=[{name:"Accum",cont:new O},{name:"Bar",cont:new _},{name:"Circle",cont:new b}];return{ist:new p,filtering:!1,filter:{center:1200,amp:500,lfreq:50},components:t,accum_idx:t.findIndex(function(t){var e=t.name;return"Accum"===e})}},mounted:function(){var t=this,e=document.getElementById("canvas"),i=document.getElementById("audiosource");i.addEventListener("play",function(){t.ist.init({width:e.width,height:e.height,ctx:e.getContext("2d"),components:t.components.map(function(t){var e=t.cont;return e}),audio:i})},{once:!0})},watch:{filter:{handler:function(){this.ist.update_filter(this.filter.center,this.filter.amp,this.filter.lfreq)},deep:!0}},methods:{loadAudio:function(t){var e=new FileReader,i=t.target.files[0];i&&i.type.match("audio.*")&&(e.onload=function(t){var e=t.target.result;document.getElementById("audiosource").src=e},e.readAsDataURL(i))},toggle:function(){this.filtering=this.ist.toggle_filter(this.filter.center,this.filter.amp,this.filter.lfreq)}}},q=j,k=(i("074f"),i("2877")),A=Object(k["a"])(q,o,c,!1,null,"426cc7a7",null),T=A.exports,P={name:"app",components:{Visualizer:T}},M=P,S=(i("034f"),Object(k["a"])(M,r,a,!1,null,null,null)),$=S.exports;n["a"].config.productionTip=!1,new n["a"]({render:function(t){return t($)}}).$mount("#app")},"64a9":function(t,e,i){}});
//# sourceMappingURL=app.57bbccdb.js.map