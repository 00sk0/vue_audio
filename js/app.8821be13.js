(function(t){function e(e){for(var n,a,s=e[0],c=e[1],l=e[2],u=0,f=[];u<s.length;u++)a=s[u],Object.prototype.hasOwnProperty.call(r,a)&&r[a]&&f.push(r[a][0]),r[a]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);h&&h(e);while(f.length)f.shift()();return o.push.apply(o,l||[]),i()}function i(){for(var t,e=0;e<o.length;e++){for(var i=o[e],n=!0,s=1;s<i.length;s++){var c=i[s];0!==r[c]&&(n=!1)}n&&(o.splice(e--,1),t=a(a.s=i[0]))}return t}var n={},r={app:0},o=[];function a(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=n,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(i,n,function(e){return t[e]}.bind(null,n));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/vue_audio/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var h=c;o.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"034f":function(t,e,i){"use strict";var n=i("85ec"),r=i.n(n);r.a},"35b8":function(t,e,i){"use strict";var n=i("fdb9"),r=i.n(n);r.a},"56d7":function(t,e,i){"use strict";i.r(e);i("e260"),i("e6cf"),i("cca6"),i("a79d");var n=i("2b0e"),r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("visualizer")],1)},o=[],a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"main"}},[i("canvas",{attrs:{id:"canvas",width:"640px",height:"360px"}}),i("div",{attrs:{id:"ctrls"}},[i("p",[i("audio",{attrs:{controls:"",id:"audiosource",loop:"",volume:"0.5"}}),i("input",{attrs:{type:"file",id:"audiofile",accept:"audio/*"},on:{change:t.loadAudio}})]),i("p",[t._l(t.components,(function(e){return i("span",{key:e.name},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.cont.on,expression:"cp.cont.on"}],attrs:{type:"checkbox",id:e.name},domProps:{checked:Array.isArray(e.cont.on)?t._i(e.cont.on,null)>-1:e.cont.on},on:{change:function(i){var n=e.cont.on,r=i.target,o=!!r.checked;if(Array.isArray(n)){var a=null,s=t._i(n,a);r.checked?s<0&&t.$set(e.cont,"on",n.concat([a])):s>-1&&t.$set(e.cont,"on",n.slice(0,s).concat(n.slice(s+1)))}else t.$set(e.cont,"on",o)}}}),i("label",{attrs:{for:e.name}},[t._v(t._s(e.name))])])})),t._v(" | Accum_interval: "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.components[0].cont.interval,expression:"components[0].cont.interval"}],attrs:{type:"number",min:"0"},domProps:{value:t.components[0].cont.interval},on:{input:function(e){e.target.composing||t.$set(t.components[0].cont,"interval",e.target.value)}}}),t._v(" Accum_amp_kind: "),i("select",{directives:[{name:"model",rawName:"v-model",value:t.components[0].cont.amp_kind,expression:"components[0].cont.amp_kind"}],on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.components[0].cont,"amp_kind",e.target.multiple?i:i[0])}}},[i("option",{attrs:{selected:""}},[t._v("linear")]),i("option",[t._v("log")]),i("option",[t._v("exp")])]),t._v(" Accum_log_coeff: "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.components[0].cont.log_coeff,expression:"components[0].cont.log_coeff"}],attrs:{type:"number",min:"0"},domProps:{value:t.components[0].cont.log_coeff},on:{input:function(e){e.target.composing||t.$set(t.components[0].cont,"log_coeff",e.target.value)}}}),t._v(" Accum_exp_base: "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.components[0].cont.exp_base,expression:"components[0].cont.exp_base"}],attrs:{type:"number",min:"1.001",max:"1.1",step:"0.001"},domProps:{value:t.components[0].cont.exp_base},on:{input:function(e){e.target.composing||t.$set(t.components[0].cont,"exp_base",e.target.value)}}})],2),i("p",[t._v("filter: "),i("button",{on:{click:t.toggle}},[t._v(t._s((t.filtering?"on":"off")+" -> "+(t.filtering?"off":"on")))]),t._v(" lfo_center="),i("input",{directives:[{name:"model",rawName:"v-model",value:t.filter.center,expression:"filter.center"}],attrs:{type:"number",min:"1"},domProps:{value:t.filter.center},on:{input:function(e){e.target.composing||t.$set(t.filter,"center",e.target.value)}}}),t._v("[Hz], lfo_amp="),i("input",{directives:[{name:"model",rawName:"v-model",value:t.filter.amp,expression:"filter.amp"}],attrs:{type:"number"},domProps:{value:t.filter.amp},on:{input:function(e){e.target.composing||t.$set(t.filter,"amp",e.target.value)}}}),t._v("[Hz], lfo_freq="),i("input",{directives:[{name:"model",rawName:"v-model",value:t.filter.lfreq,expression:"filter.lfreq"}],attrs:{type:"number",min:"0"},domProps:{value:t.filter.lfreq},on:{input:function(e){e.target.composing||t.$set(t.filter,"lfreq",e.target.value)}}}),t._v("[count]. ")])])])},s=[],c=(i("4de4"),i("c740"),i("d81d"),i("b0c0"),i("ac1f"),i("466d"),i("a630"),i("ace4"),i("d3b7"),i("3ca3"),i("cfc3"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a9"),i("72f7"),i("159b"),i("3835")),l=i("d4ec"),h=i("bee2"),u=function(){function t(){Object(l["a"])(this,t),this.fft_size=2048}return Object(h["a"])(t,[{key:"init",value:function(t){var e=t.width,i=t.height,n=t.ctx,r=t.audio,o=t.components;this.width=e,this.height=i,this.cctx=n,this.init_nodes(r);var a=this.anlz.frequencyBinCount;this.length=a;var s=this.calc_log(),l=Object(c["a"])(s,2),h=l[0],u=l[1];this.length_log=h,this.buf_time=new Float32Array(a),this.buf_freq=new Float32Array(a),this.buf_freq_log=new Float32Array(h),this.components=this.init_components(u,o),this.filtering=!1,this.loop()}},{key:"init_nodes",value:function(t){var e=new AudioContext,i=e.createGain();i.connect(e.destination);var n=e.createBiquadFilter();n.type="highshelf",n.connect(i);var r=e.createAnalyser();r.fftSize=this.fft_size,i.connect(r);var o=e.createMediaElementSource(t);o.connect(n),this.actx=e,this.anlz=r,this.out=i,this.filter=n,this.filter_count=0,this.filter_center=0,this.filter_amp=0,this.filter_lfreq=0,this.audio=o}},{key:"init_components",value:function(t,e){var i=this,n=[this.length,this.length_log],r=n[0],o=n[1],a=Array.from({length:r},(function(t,e){return e*i.width/r}));a.push(this.width);var s={width:this.width,height:this.height,length:r,pos:a,ctx:this.cctx},c={width:this.width,height:this.height,length:o,pos:t,ctx:this.cctx},l={arg_linear:s,arg_log:c};return e.map((function(t){return t.init(l),t}))}},{key:"update_filter",value:function(t,e,i){this.filter_center=t,this.filter_amp=e,this.filter_lfreq=i}},{key:"toggle_filter",value:function(t,e,i){var n=this.actx;if(this.filter)return this.filtering=!this.filtering,this.filtering?(this.filter.Q.setValueAtTime(4,n.currentTime),this.filter_center=t,this.filter_amp=e,this.filter_lfreq=i,this.filter.type="lowpass"):(this.filter.frequency.cancelScheduledValues(n.currentTime),this.filter.gain.cancelScheduledValues(n.currentTime),this.filter.Q.cancelScheduledValues(n.currentTime),this.filter.type="highshelf",this.filter.frequency.setValueAtTime(0,n.currentTime),this.filter.gain.setValueAtTime(0,n.currentTime)),this.filtering}},{key:"loop",value:function(){if(this.filtering&&"lowpass"===this.filter.type&&this.filter_lfreq>=1){var t=this.actx;this.filter.frequency.cancelScheduledValues(t.currentTime),this.filter.gain.cancelScheduledValues(t.currentTime),this.filter.Q.cancelScheduledValues(t.currentTime);var e=1*this.filter_center+1*this.filter_amp*Math.sin(this.filter_count/this.filter_lfreq*2*Math.PI);this.filter.frequency.setValueAtTime(e,this.actx.currentTime)}this.filter_count++>=this.filter_lfreq&&(this.filter_count=0),this.anlz.getFloatTimeDomainData(this.buf_time),this.anlz.getFloatFrequencyData(this.buf_freq);var i=this.anlz.minDecibels,n=this.anlz.maxDecibels;this.buf_time=this.buf_time.map((function(t){var e=(t-i)/(n-i);return Math.min(1,Math.max(0,e))})),this.buf_freq=this.buf_freq.map((function(t){var e=(t-i)/(n-i);return Math.min(1,Math.max(0,e))})),this.update_buf_freq_log();var r={buf_time:this.buf_time,buf_freq:this.buf_freq,buf_freq_log:this.buf_freq_log};this.cctx.clearRect(0,0,this.width,this.height),this.components.forEach((function(t){return t.draw(r)})),requestAnimationFrame(this.loop.bind(this))}},{key:"x_calc",value:function(t){return 0===t?0:Math.log(t)*this.width/Math.log(this.length)}},{key:"update_buf_freq_log",value:function(){for(var t=0,e=0,i=0,n=0,r=0;r<this.buf_freq.length;r++){var o=this.buf_freq[r],a=this.x_calc(r),s=this.x_calc(r+1)-a;a+s-t<4?(i++,e+=o):(this.buf_freq_log[n]=(e+o)/(i+1),n++,t=a+s,i=0,e=0)}}},{key:"calc_log",value:function(){for(var t=0,e=[],i=0,n=0;n<this.length;n++){var r=this.x_calc(n),o=this.x_calc(n+1)-r;r+o-t>=4&&(i++,e.push(t),t=r+o)}return e.push(this.width),[i,e]}}]),t}(),f=i("99de"),p=i("7e84"),d=i("262e"),m=function(){function t(){Object(l["a"])(this,t),this.inited=!1,this.on=!0}return Object(h["a"])(t,[{key:"init_log",value:function(t){var e=t.arg_log,i=e.width,n=e.height,r=e.length,o=e.pos,a=e.ctx;this.inited=!0,this.width=i,this.height=n,this.length=r,this.pos=o,this.ctx=a}},{key:"init_linear",value:function(t){var e=t.arg_linear,i=e.width,n=e.height,r=e.length,o=e.pos,a=e.ctx;this.inited=!0,this.width=i,this.height=n,this.length=r,this.pos=o,this.ctx=a}},{key:"init",value:function(t){this.init_log(t)}},{key:"draw",value:function(t){this.ctx.save(),this.inited&&this.on&&this.draw_internal(t),this.ctx.restore()}},{key:"draw_internal",value:function(){throw new Error("to be implemented")}},{key:"toggle",value:function(){this.on=!this.on}}]),t}(),v=function(t){function e(){return Object(l["a"])(this,e),Object(f["a"])(this,Object(p["a"])(e).apply(this,arguments))}return Object(d["a"])(e,t),Object(h["a"])(e,[{key:"draw_internal",value:function(t){var e=t.buf_freq_log;this.ctx.fillStyle="hsla(0,60%,60%,0.8)";for(var i=0;i<this.length;i++){var n=[this.pos[i],this.pos[i+1]],r=n[0],o=n[1],a=e[i]*this.height;this.ctx.fillRect(r,this.height-a,o-r,a)}}}]),e}(m),g=(i("cb29"),function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return[i+t*Math.cos(2*e*Math.PI-Math.PI/2),n+t*Math.sin(2*e*Math.PI-Math.PI/2)]}),_=function(t){function e(){return Object(l["a"])(this,e),Object(f["a"])(this,Object(p["a"])(e).apply(this,arguments))}return Object(d["a"])(e,t),Object(h["a"])(e,[{key:"draw_internal",value:function(t){var e=t.buf_freq_log,i=this.width/2,n=this.height/2,r=3*this.height/16,o=1*this.height/4;this.ctx.fillStyle="hsla(120,60%,60%,0.8)";for(var a=0;a<this.length;a++){var s=e[a],l=this.pos[a]/this.width,h=this.pos[a+1]/this.width,u=0,f=g(r,l-u,i,n),p=Object(c["a"])(f,2),d=p[0],m=p[1],v=g(r,h-u,i,n),_=Object(c["a"])(v,2),b=_[0],y=_[1],x=g(s*o,(l+h)/2-u),w=Object(c["a"])(x,2),O=w[0],j=w[1];this.ctx.beginPath(),this.ctx.moveTo(b,y),this.ctx.lineTo(d,m),this.ctx.lineTo(d+O,m+j),this.ctx.lineTo(b+O,y+j),this.ctx.closePath(),this.ctx.fill()}}}]),e}(m),b=(i("99af"),i("7db0"),i("2909")),y=i("45eb"),x=function(t){function e(){var t;return Object(l["a"])(this,e),t=Object(f["a"])(this,Object(p["a"])(e).apply(this,arguments)),t.idx=0,t.count=0,t.cells=64,t.histories=[],t.span=3,t.processing=[],t.amp_kind="linear",t.log_coeff=32,t.exp_base=1.01,t}return Object(d["a"])(e,t),Object(h["a"])(e,[{key:"init",value:function(t){Object(y["a"])(Object(p["a"])(e.prototype),"init",this).call(this,t),this.processing=Object(b["a"])(Array(this.length)).map((function(t){return 0}))}},{key:"draw_internal",value:function(t){var e=this,i=t.buf_freq_log;if(this.processing=this.processing.map((function(t,e){return t+i[e]})),this.count++>=this.span){if(this.processing=this.processing.map((function(t){return t/e.count})),this.processing.findIndex((function(t){return t<0||t>1}))>=0)throw new Error("invalid value: [".concat(this.processing,"]"));this.histories[this.idx]=this.processing.map((function(t){return t})),this.idx++,this.idx===this.cells&&(this.idx=0),this.processing=Object(b["a"])(Array(this.length)).map((function(t){return 0})),this.count=0}for(var n=function(t){var i=(t+e.idx)%e.cells,n=t*e.height/e.cells;if(e.histories[i]&&"undefined"!==typeof e.histories[i].find((function(t){return t>0})))for(var r=function(t){var r=[e.pos[t],e.pos[t+1]],o=r[0],a=r[1],s=function(){var n=e.histories[i][t];switch(console.assert(0<=n&&n<=1),e.amp_kind){case"linear":return n;case"log":var r=Math.pow(1.1,e.log_coeff);return Math.log(255*n/r+1)/Math.log(255/r+1);case"exp":var o=e.exp_base;return Math.pow(o,255*(n-1))}}();console.assert(0<=s&&s<=1),e.ctx.fillStyle="hsla(".concat(205+60*s,",60%,60%,").concat(s,")"),e.ctx.fillRect(o,n,a-o,e.height/e.cells)},o=0;o<e.length;o++)r(o)},r=0;r<this.cells;r++)n(r)}},{key:"interval",get:function(){return this.span},set:function(t){this.span=t,this.processing=Object(b["a"])(Array(this.length)).map((function(t){return 0})),this.count=0}}]),e}(m),w={name:"Visualizer",data:function(){var t=[{name:"Accum",cont:new x},{name:"Bar",cont:new v},{name:"Circle",cont:new _}];return{ist:new u,filtering:!1,filter:{center:1200,amp:500,lfreq:50},components:t,accum_idx:t.findIndex((function(t){var e=t.name;return"Accum"===e}))}},mounted:function(){var t=this,e=document.getElementById("canvas"),i=document.getElementById("audiosource");i.volume=.5,i.addEventListener("play",(function(){t.ist.init({width:e.width,height:e.height,ctx:e.getContext("2d"),components:t.components.map((function(t){var e=t.cont;return e})),audio:i})}),{once:!0})},watch:{filter:{handler:function(){this.ist.update_filter(this.filter.center,this.filter.amp,this.filter.lfreq)},deep:!0}},methods:{loadAudio:function(t){var e=new FileReader,i=t.target.files[0];i&&i.type.match("audio.*")&&(e.onload=function(t){var e=t.target.result;document.getElementById("audiosource").src=e},e.readAsDataURL(i))},toggle:function(){this.filtering=this.ist.toggle_filter(this.filter.center,this.filter.amp,this.filter.lfreq)}}},O=w,j=(i("35b8"),i("2877")),q=Object(j["a"])(O,a,s,!1,null,"164ccb7d",null),k=q.exports,A={name:"app",components:{Visualizer:k}},M=A,T=(i("034f"),Object(j["a"])(M,r,o,!1,null,null,null)),P=T.exports;n["a"].config.productionTip=!1,new n["a"]({render:function(t){return t(P)}}).$mount("#app")},"85ec":function(t,e,i){},fdb9:function(t,e,i){}});
//# sourceMappingURL=app.8821be13.js.map