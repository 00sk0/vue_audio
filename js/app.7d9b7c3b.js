(function(t){function e(e){for(var n,a,c=e[0],o=e[1],l=e[2],u=0,f=[];u<c.length;u++)a=c[u],r[a]&&f.push(r[a][0]),r[a]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n]);h&&h(e);while(f.length)f.shift()();return s.push.apply(s,l||[]),i()}function i(){for(var t,e=0;e<s.length;e++){for(var i=s[e],n=!0,c=1;c<i.length;c++){var o=i[c];0!==r[o]&&(n=!1)}n&&(s.splice(e--,1),t=a(a.s=i[0]))}return t}var n={},r={app:0},s=[];function a(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=n,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(i,n,function(e){return t[e]}.bind(null,n));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/vue_audio/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],o=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var h=o;s.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"034f":function(t,e,i){"use strict";var n=i("64a9"),r=i.n(n);r.a},1669:function(t,e,i){},"56d7":function(t,e,i){"use strict";i.r(e);i("cadf"),i("551c"),i("f751"),i("097d");var n=i("2b0e"),r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("visualizer")],1)},s=[],a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"main"}},[i("canvas",{attrs:{id:"canvas",width:"640px",height:"360px"}}),i("div",{attrs:{id:"ctrls"}},[i("p",[i("audio",{attrs:{controls:"",id:"audiosource"}}),i("input",{attrs:{type:"file",id:"audiofile",accept:"audio/*"},on:{change:t.loadAudio}})]),i("p",[t._l(t.components,function(e){return i("span",{key:e.name},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.cont.on,expression:"cp.cont.on"}],attrs:{type:"checkbox",id:e.name},domProps:{checked:Array.isArray(e.cont.on)?t._i(e.cont.on,null)>-1:e.cont.on},on:{change:function(i){var n=e.cont.on,r=i.target,s=!!r.checked;if(Array.isArray(n)){var a=null,c=t._i(n,a);r.checked?c<0&&t.$set(e.cont,"on",n.concat([a])):c>-1&&t.$set(e.cont,"on",n.slice(0,c).concat(n.slice(c+1)))}else t.$set(e.cont,"on",s)}}}),i("label",{attrs:{for:e.name}},[t._v(t._s(e.name))])])}),t._v("\n      |\n      Accum_interval: "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.components[0].cont.span,expression:"components[0].cont.span"}],attrs:{type:"text"},domProps:{value:t.components[0].cont.span},on:{input:function(e){e.target.composing||t.$set(t.components[0].cont,"span",e.target.value)}}})],2),i("p",[t._v("filter: "+t._s(t.filtering?"on":"off")+".\n      "),i("button",{on:{click:t.toggle}},[t._v("toggle")])]),i("p",[t._v("\n      filter_lfo_center="),i("input",{directives:[{name:"model",rawName:"v-model",value:t.filter.center,expression:"filter.center"}],attrs:{type:"text"},domProps:{value:t.filter.center},on:{input:function(e){e.target.composing||t.$set(t.filter,"center",e.target.value)}}}),t._v("[Hz],\n      filter_lfo_amp="),i("input",{directives:[{name:"model",rawName:"v-model",value:t.filter.amp,expression:"filter.amp"}],attrs:{type:"text"},domProps:{value:t.filter.amp},on:{input:function(e){e.target.composing||t.$set(t.filter,"amp",e.target.value)}}}),t._v("[Hz],\n      filter_lfo_freq="),i("input",{directives:[{name:"model",rawName:"v-model",value:t.filter.lfreq,expression:"filter.lfreq"}],attrs:{type:"text"},domProps:{value:t.filter.lfreq},on:{input:function(e){e.target.composing||t.$set(t.filter,"lfreq",e.target.value)}}}),t._v("[count].\n    ")])])])},c=[],o=(i("4917"),i("ac6a"),i("774e")),l=i.n(o),h=(i("34ef"),i("768b")),u=i("d225"),f=i("b0b4"),d=function(){function t(){Object(u["a"])(this,t),this.fft_size=1024}return Object(f["a"])(t,[{key:"init",value:function(t){var e=t.width,i=t.height,n=t.ctx,r=t.audio,s=t.components;this.width=e,this.height=i,this.cctx=n,this.init_nodes(r);var a=this.anlz.frequencyBinCount;this.length=a;var c=this.calc_log(),o=Object(h["a"])(c,2),l=o[0],u=o[1];this.length_log=l,this.buf_time=new Uint8Array(a),this.buf_freq=new Uint8Array(a),this.buf_freq_log=new Uint8Array(l),this.components=this.init_components(u,s),this.filtering=!1,this.loop()}},{key:"init_nodes",value:function(t){var e=new AudioContext,i=e.createGain();i.connect(e.destination);var n=e.createBiquadFilter();n.type="highshelf",n.connect(i);var r=e.createAnalyser();r.fftSize=this.fft_size,i.connect(r);var s=e.createMediaElementSource(t);s.connect(n),this.actx=e,this.anlz=r,this.out=i,this.filter=n,this.filter_count=0,this.filter_center=0,this.filter_amp=0,this.filter_lfreq=0,this.audio=s}},{key:"init_components",value:function(t,e){var i=this,n=[this.length,this.length_log],r=n[0],s=n[1],a=l()({length:r},function(t,e){return e*i.width/r});a.push(this.width);var c={width:this.width,height:this.height,length:r,pos:a,ctx:this.cctx},o={width:this.width,height:this.height,length:s,pos:t,ctx:this.cctx},h={arg_linear:c,arg_log:o};return e.map(function(t){return t.init(h),t})}},{key:"update_filter",value:function(t,e,i){this.filter_center=t,this.filter_amp=e,this.filter_lfreq=i}},{key:"toggle_filter",value:function(t,e,i){var n=this.actx;return this.filtering?(this.filtering=!1,this.filter.frequency.cancelScheduledValues(n.currentTime),this.filter.gain.cancelScheduledValues(n.currentTime),this.filter.Q.cancelScheduledValues(n.currentTime),this.filter.type="highshelf",this.filter.frequency.setValueAtTime(0,n.currentTime),this.filter.gain.setValueAtTime(0,n.currentTime)):(this.filtering=!0,this.filter.Q.setValueAtTime(4,n.currentTime),this.filter_center=t,this.filter_amp=e,this.filter_lfreq=i,this.filter.type="lowpass"),this.filtering}},{key:"loop",value:function(){if(this.filtering&&"lowpass"===this.filter.type&&this.filter_lfreq>=1){var t=this.actx;this.filter.frequency.cancelScheduledValues(t.currentTime),this.filter.gain.cancelScheduledValues(t.currentTime),this.filter.Q.cancelScheduledValues(t.currentTime);var e=1*this.filter_center+1*this.filter_amp*Math.sin(this.filter_count/this.filter_lfreq*2*Math.PI);this.filter.frequency.setValueAtTime(e,this.actx.currentTime)}this.filter_count++>=this.filter_lfreq&&(this.filter_count=0),this.anlz.getByteTimeDomainData(this.buf_time),this.anlz.getByteFrequencyData(this.buf_freq),this.update_buf_freq_log();var i={buf_time:this.buf_time,buf_freq:this.buf_freq,buf_freq_log:this.buf_freq_log};this.cctx.clearRect(0,0,this.width,this.height),this.components.forEach(function(t){return t.draw(i)}),requestAnimationFrame(this.loop.bind(this))}},{key:"x_calc",value:function(t){return 0===t?0:Math.log(t)*this.width/Math.log(this.length)}},{key:"update_buf_freq_log",value:function(){for(var t=0,e=0,i=0,n=0,r=0;r<this.buf_freq.length;r++){var s=this.buf_freq[r],a=this.x_calc(r),c=this.x_calc(r+1)-a;a+c-t<4?(i++,e+=s):(this.buf_freq_log[n]=(e+s)/(i+1),n++,t=a+c,i=0,e=0)}}},{key:"calc_log",value:function(){for(var t=0,e=[],i=0,n=0;n<this.length;n++){var r=this.x_calc(n),s=this.x_calc(n+1)-r;r+s-t<4?0:(i++,e.push(t),t=r+s,0)}return e.push(this.width),[i,e]}}]),t}(),p=i("308d"),g=i("6bb5"),v=i("4e2b"),m=function(){function t(){Object(u["a"])(this,t),this.inited=!1,this.on=!0}return Object(f["a"])(t,[{key:"init_log",value:function(t){var e=t.arg_log,i=e.width,n=e.height,r=e.length,s=e.pos,a=e.ctx;this.inited=!0,this.width=i,this.height=n,this.length=r,this.pos=s,this.ctx=a}},{key:"init_linear",value:function(t){var e=t.arg_linear,i=e.width,n=e.height,r=e.length,s=e.pos,a=e.ctx;this.inited=!0,this.width=i,this.height=n,this.length=r,this.pos=s,this.ctx=a}},{key:"init",value:function(t){this.init_log(t)}},{key:"draw",value:function(t){this.ctx.save(),this.inited&&this.on&&this.draw_internal(t),this.ctx.restore()}},{key:"draw_internal",value:function(){throw new Error("to be implemented")}},{key:"toggle",value:function(){this.on=!this.on}}]),t}(),_=function(t){function e(){return Object(u["a"])(this,e),Object(p["a"])(this,Object(g["a"])(e).apply(this,arguments))}return Object(v["a"])(e,t),Object(f["a"])(e,[{key:"draw_internal",value:function(t){var e=t.buf_freq_log;this.ctx.fillStyle="hsla(0,60%,60%,0.8)";for(var i=0;i<this.length;i++){var n=[this.pos[i],this.pos[i+1]],r=n[0],s=n[1],a=e[i]*this.height/255;this.ctx.fillRect(r,this.height-a,s-r,a)}}}]),e}(m),b=(i("6c7b"),function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return[i+t*Math.cos(2*e*Math.PI-Math.PI/2),n+t*Math.sin(2*e*Math.PI-Math.PI/2)]}),y=function(t){function e(){return Object(u["a"])(this,e),Object(p["a"])(this,Object(g["a"])(e).apply(this,arguments))}return Object(v["a"])(e,t),Object(f["a"])(e,[{key:"draw_internal",value:function(t){var e=t.buf_freq_log,i=this.width/2,n=this.height/2,r=3*this.height/16,s=1*this.height/4;this.ctx.fillStyle="hsla(120,60%,60%,0.8)";for(var a=0;a<this.length;a++){var c=e[a]/255,o=this.pos[a]/this.width,l=this.pos[a+1]/this.width,u=0,f=b(r,o-u,i,n),d=Object(h["a"])(f,2),p=d[0],g=d[1],v=b(r,l-u,i,n),m=Object(h["a"])(v,2),_=m[0],y=m[1],x=b(c*s,(o+l)/2-u),w=Object(h["a"])(x,2),q=w[0],O=w[1];this.ctx.beginPath(),this.ctx.moveTo(_,y),this.ctx.lineTo(p,g),this.ctx.lineTo(p+q,g+O),this.ctx.lineTo(_+q,y+O),this.ctx.closePath(),this.ctx.fill()}}}]),e}(m),x=(i("7514"),function(t){function e(){var t;return Object(u["a"])(this,e),t=Object(p["a"])(this,Object(g["a"])(e).apply(this,arguments)),t.accum=[],t.idx=0,t.count=0,t.cells=64,t.span=4,t}return Object(v["a"])(e,t),Object(f["a"])(e,[{key:"draw_internal",value:function(t){var e=t.buf_freq_log;if(this.count++>=this.span){this.count=0,this.accum[this.idx]=[];for(var i=0;i<this.length;i++)this.accum[this.idx][i]=e[i];this.idx++,this.idx===this.cells&&(this.idx=0)}for(var n=0;n<this.cells;n++){var r=(n+this.idx)%this.cells,s=n*this.height/this.cells;if(this.accum[r]&&"undefined"!==typeof this.accum[r].find(function(t){return t>0}))for(var a=0;a<this.length;a++){var c=[this.pos[a],this.pos[a+1]],o=c[0],l=c[1],h=this.accum[r][a]/255;this.ctx.fillStyle="hsla(240,60%,60%,".concat(h,")"),this.ctx.fillRect(o,s,l-o,this.height/this.cells)}}}}]),e}(m)),w={name:"Visualizer",data:function(){return{ist:new d,filtering:!1,filter:{center:1200,amp:500,lfreq:50},components:[{name:"Accum",cont:new x},{name:"Bar",cont:new _},{name:"Circle",cont:new y}]}},mounted:function(){var t=this,e=document.getElementById("canvas"),i=document.getElementById("audiosource");i.addEventListener("play",function(){t.ist.init({width:e.width,height:e.height,ctx:e.getContext("2d"),components:t.components.map(function(t){var e=t.cont;return e}),audio:i})},{once:!0})},watch:{filter:{handler:function(){this.ist.update_filter(this.filter.center,this.filter.amp,this.filter.lfreq)},deep:!0}},methods:{loadAudio:function(t){var e=new FileReader,i=t.target.files[0];i&&i.type.match("audio.*")&&(e.onload=function(t){var e=t.target.result;document.getElementById("audiosource").src=e},e.readAsDataURL(i))},toggle:function(){this.filtering=this.ist.toggle_filter(this.filter.center,this.filter.amp,this.filter.lfreq)}}},q=w,O=(i("f988"),i("2877")),j=Object(O["a"])(q,a,c,!1,null,"13a94d5e",null),k=j.exports,T={name:"app",components:{Visualizer:k}},A=T,P=(i("034f"),Object(O["a"])(A,r,s,!1,null,null,null)),S=P.exports;n["a"].config.productionTip=!1,new n["a"]({render:function(t){return t(S)}}).$mount("#app")},"64a9":function(t,e,i){},f988:function(t,e,i){"use strict";var n=i("1669"),r=i.n(n);r.a}});
//# sourceMappingURL=app.7d9b7c3b.js.map